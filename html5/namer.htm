<!DOCTYPE html>
<!--
NAMER gemini prompt:
A pure javascript webapp that presents a filename string inside an upper text field "filename" concatenating the values of a list of other text fields below. The separator is the character '-''

The filename structure is composed by

"prefix", editable: something like "fb-"
"site": may be empty
"author": may be empty
"year": may be empty
"tags". Editable, comma separated: i.e. SOURCE, REF
"hash": specify hash value generated length via menu from 8, 16, 24 alphanumeric characters.
"decription": editable text

the resulting filename is like 'fb-behindtheart-jackson_pollock-1912-ART-12341234-undiscovered_galaxy'

All the text fields can be specified and edited also via querystring, so that a specific URL can restore the filename structure
In a space is present in a text field replace it with '_'
when the button is pressed the "filename" value must be copied to clipboard (linux KDE desktop) 

The must be a button to generate another filename.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FILENAMER - v0.5</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 850px; margin: 2rem auto; padding: 0 1rem; background: #f0f2f5; color: #333; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .field-group { margin-bottom: 1.2rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.4rem; font-size: 0.85rem; text-transform: uppercase; color: #666; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; transition: border 0.2s; }
        input:focus { border-color: #3b82f6; outline: none; }
        #filename { background: #f8fafc; font-family: monospace; font-weight: bold; color: #1e293b; border: 2px solid #3b82f6; cursor: default; }
        .controls { display: flex; gap: 12px; margin-top: 2rem; }
        button { flex: 1; padding: 12px; cursor: pointer; border: none; border-radius: 6px; background: #3b82f6; color: white; font-weight: bold; font-size: 1rem; }
        button:hover { background: #2563eb; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin-top:0">FILENAMER v0.5 by masayume</h2>
    
    <div class="field-group">
        <label>Generated Filename (Auto-updates)</label>
        <input type="text" id="filename" readonly placeholder="Resulting name...">
    </div>

    <hr style="border: 0; border-top: 1px solid #eee; margin: 1.5rem 0;">

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="field-group">
            <label>Prefix</label>
            <input type="text" id="prefix" placeholder="e.g. fb-">
        </div>
        <div class="field-group">
            <label>Site</label>
            <input type="text" id="site">
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="field-group">
            <label>Author</label>
            <input type="text" id="author">
        </div>
        <div class="field-group">
            <label>Other</label>
            <input type="text" id="other">
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="field-group">
            <label>Year</label>
            <input type="text" id="year">
        </div>
        <div class="field-group">
            <label>Hash Length</label>
            <select id="hashLength">
<!--                <option value="8">8 chars</option> -->
                <option value="16">16 chars</option>
                <option value="24">24 chars</option>
                <option value="32">32 chars</option>
            </select>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="field-group">
            <label>Tags (comma separated)</label>
            <input type="text" id="tags" placeholder="SOURCE, REF">
        </div>
        <div class="field-group">
            <label>Pre-Description</label>
            <input type="text" id="predescription">
        </div>
    </div>

    <div class="field-group">
        <label>Description</label>
        <input type="text" id="description">
    </div>

    <div class="field-group">
        <div class="controls">
            <button id="mainBtn">Generate & Copy to Clipboard</button>
        </div>
        <div class="actions">
            <a id="google-cover-link" href="#" target="_blank" style="display:none; margin-left: 10px;">
                üñºÔ∏è Find Cover
            </a>
        </div>
    </div>

</div>

<div id="toast" class="toast">Copied to clipboard!</div>

<script>
    const fields = ['prefix', 'site', 'author', 'other', 'year', 'tags', 'hashLength', 'predescription', 'description'];
    let currentHash = '';

    window.onload = () => {
        const params = new URLSearchParams(window.location.search);
        
        fields.forEach(field => {
            const val = params.get(field);
            if (val !== null) document.getElementById(field).value = val;
        });

        generateNewHash();
        
        fields.forEach(field => {
            document.getElementById(field).addEventListener('input', () => {
                updateFilename();
                updateURL();
            });
        });

        document.getElementById('mainBtn').addEventListener('click', () => {
            generateNewHash();
            copyToClipboard();
        });
    };

    function generateHash(length) {
        const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < length; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    function generateNewHash() {
        const len = document.getElementById('hashLength').value;
        currentHash = generateHash(parseInt(len));
        updateFilename();
    }

    function formatString(str) {
        // Replace spaces with underscores
        return str.trim().replace(/\s+/g, '_');
    }

    function updateFilename() {
        const values = {
            prefix: formatString(document.getElementById('prefix').value),
            site: formatString(document.getElementById('site').value).replace(/(^\w+:|^)\/\//, '').replace(/\//g,'|').replace(/-/g, '='),
            author: formatString(document.getElementById('author').value),
            other: formatString(document.getElementById('other').value),
            year: formatString(document.getElementById('year').value),
            tags: formatString(document.getElementById('tags').value).replace(/,/g, '-'),
            hash: currentHash,
            predescription: formatString(document.getElementById('predescription').value),
            description: formatString(document.getElementById('description').value).replace(/[ -.]/g, '_').toLowerCase(),
        };

        const filtered = Object.values(values).filter(val => val !== '');

        // Separate the last item from the rest
        const last = filtered.pop(); 
        const result = filtered.length > 0 
            ? filtered.join('-') + last 
            : (last || '');


        document.getElementById('filename').value = result;
    }

    function updateURL() {
        const params = new URLSearchParams();
        fields.forEach(field => {
            const val = document.getElementById(field).value;
            if (val) params.set(field, val);
        });
        history.replaceState(null, '', '?' + params.toString());
    }

    async function copyToClipboard() {
        const text = document.getElementById("filename").value;

        // 1. Try Modern Clipboard API (Requires HTTPS)
        if (navigator.clipboard && navigator.clipboard.writeText) {
            try {
                await navigator.clipboard.writeText(text);
                showToast();
                return; // Success!
            } catch (err) {
                console.error('Clipboard API failed:', err);
            }
        }

        // 2. Fallback Method (Works on HTTP / Older Browsers)
        try {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            
            // Hide the textarea off-screen
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            
            textArea.focus();
            textArea.select();
            
            const successful = document.execCommand('copy');
            document.body.removeChild(textArea);

            if (successful) {
                showToast();
            } else {
                throw new Error('execCommand returned false');
            }
        } catch (err) {
            console.error('Fallback copy failed:', err);
            alert('Copy failed. Please manually copy the text.');
        }
    } // copyToClipboard

    function updateCoverLink() {
        const pre = document.getElementById("predescription").value || "";
        const desc = document.getElementById("description").value || "";
        
        // Combine and clean: "pc_engine_ HANY ON THE ROAD cover"
        const fullSearch = `${pre} ${desc} cover`.trim();
        
        // Encode for URL (converts spaces to %20, etc.)
        const encoded = encodeURIComponent(fullSearch);
        const url = `https://www.google.com/search?tbm=isch&q=${encoded}`;
        
        // Target the link element
        const link = document.getElementById("google-cover-link");
        if (link) {
            link.href = url;
            link.style.display = "inline"; // Show it once there is a value
        }
    } // updateCoverLink()

    function showToast() {
        const toast = document.getElementById('toast');
        toast.style.opacity = '1';
        setTimeout(() => { toast.style.opacity = '0'; }, 2000);
    }


    document.getElementById("description").addEventListener("input", updateCoverLink);
    document.getElementById("predescription").addEventListener("input", updateCoverLink);

    // 1. Grab your elements
    const mainBtn = document.getElementById('mainBtn');
    const myLink = document.getElementById('google-cover-link'); // Your 'a' tag

    // 2. The Keyboard Listener
    window.addEventListener('keydown', (event) => {
        // Check if the pressed key is "Space" (code "Space" or key " ")
        // We also check !event.repeat to prevent "machine-gunning" if the key is held down
        if (event.code === 'Space' && !event.repeat) {
            
            // Prevent default page scrolling behavior when pressing space
            event.preventDefault();

            // Trigger the button's logic
            mainBtn.click();

            // Open the link in a new window/tab
            // Ensure the 'a' tag has target="_blank"
            myLink.target = "_blank";
            myLink.click();
        }
    });

</script>

</body>
</html> 
